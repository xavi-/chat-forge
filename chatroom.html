<!DOCTYPE html>
<head>
<title>(:room-name:)</title>  
<style>
    .chat {
        -moz-box-sizing: border-box;
        -webkit-box-sizing: border-box;
        box-sizing: border-box;
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0;
        left: 0;
        padding-bottom: 26px;
    }

    .line { 
        font-size: 16px; 
        font-family: sans-serif;
    }

    .chat-text {
        height: 100%;
        border: 1px solid black;
        padding: 0px 4px;
        overflow: auto;
    }

    .enterName {
        cursor: pointer;
        border: thin solid #770077;
        border-left: thin solid #FF00FF;
        border-top: thin solid #FF00FF;
        background-color: #FFCCFF;
        text-align: center;
        height: 20px;
    }

    .reply {
        border: 1px solid black;
    }

    .reply input {
        margin: 0px;
        display: block;
        border: 0px solid black;
        width: 100%;
        height: 20px;
        font-size: 15px;
}
</style>
</head>
<body>
    <div class="chat">
        <div class="chat-text">
            (:chat-text ~ <div class="line">[:name :]: [:text:]</div> :)
        </div>
        <div class="reply">
            (:reply ~
                [:send-line ~ <input class="sendLine" type="text" />:]
                [:enter-name ~ <div class="enterName">Click to join</div>:]:)
        </div>
    </div>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.js" type="text/javascript"></script>
<script src="/json2.js" type="text/javascript"></script>
<script src="/client.js" type="text/javascript"></script>
<script type="text/javascript">
$(function() {
    var name = "(:user-name:)";

    function addLine(name, line) {
        $("<div class='line' />")
            .text(name + ": " + line)
            .appendTo("div.chat-text");
        $("div.chat-text").scrollTop($("div.chat-text").height());
    }
        
    $(".sendLine").live("keydown", function(e) {
        var line = $(this).val();
        
        if(e.which == 13 && line) { 
            ch.send({ name: name, text: line });
            addLine(name, line);
            $(this).val(""); 
        } 
    })
    .focus();
    
    $(".enterName").click(function() { 
        name = window.prompt("Enter your name");
        
        if(name) {
            document.cookie = "name=" + name + "; path=/";
                
            $("<input class='sendLine' type='text' />")
                .replaceAll(".reply div.enterName")
                .focus();
        }
    });
    
    var ch = new Channel("(:room-name:)", (:initial-info-id:));
    ch.onReceive(function(msg) { addLine(msg.content.name, msg.content.text); });
    $(window).load(function() { setTimeout(function() { ch.start(); }, 0); });
});
</script>
</body>
</html>